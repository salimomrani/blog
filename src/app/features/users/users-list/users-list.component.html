<div class="container-custom py-12">
  <!-- Header -->
  <div class="flex justify-between items-center mb-8">
    <div>
      <h1 class="text-4xl font-bold text-gray-900 mb-2">üë• Utilisateurs</h1>
      <p class="text-gray-600">Gestion des utilisateurs de la plateforme</p>
    </div>
    @if (authStore.isAuthenticated() && usersStore.hasUsers()) {
      <a
        routerLink="/users/new"
        class="inline-flex items-center px-6 py-3 bg-gradient-to-r from-purple-600 to-blue-600 text-white font-semibold rounded-lg hover:from-purple-700 hover:to-blue-700 transition duration-150 shadow-lg"
      >
        <svg class="h-5 w-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4" />
        </svg>
        Nouvel Utilisateur
      </a>
    }
  </div>

  <!-- Filters -->
  <div class="mb-6 flex flex-col md:flex-row gap-4">
    <!-- Search -->
    <div class="flex-1">
      <input
        type="text"
        placeholder="Rechercher par nom ou email..."
        [value]="usersStore.searchQuery()"
        (input)="onSearchChange($any($event.target).value)"
        class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500"
      />
    </div>

    <!-- Role Filter -->
    <div class="w-full md:w-48">
      <select
        [value]="usersStore.roleFilter()"
        (change)="onRoleFilterChange($any($event.target).value)"
        class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500"
      >
        <option value="ALL">Tous les r√¥les</option>
        <option value="ADMIN">Administrateurs</option>
        <option value="MODERATOR">Mod√©rateurs</option>
        <option value="USER">Utilisateurs</option>
      </select>
    </div>
  </div>

  <!-- Error Message -->
  @if (usersStore.error()) {
    <app-error-message [message]="usersStore.error() || ''" [type]="'error'" />
  }

  <!-- Loading State -->
  @if (usersStore.isLoading()) {
    <div class="flex justify-center items-center py-12">
      <app-spinner [size]="'large'" [color]="'primary'" />
    </div>
  }

  <!-- Empty State -->
  @if (!usersStore.isLoading() && !usersStore.hasUsers()) {
    <div class="text-center py-16 bg-gray-50 rounded-2xl">
      <svg class="mx-auto h-24 w-24 text-gray-300 mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197M13 7a4 4 0 11-8 0 4 4 0 018 0z" />
      </svg>
      <h3 class="text-2xl font-semibold text-gray-700 mb-2">Aucun utilisateur</h3>
      <p class="text-gray-500 mb-6">Aucun utilisateur trouv√©</p>
    </div>
  }

  <!-- Users Table -->
  @if (!usersStore.isLoading() && usersStore.hasUsers()) {
    <div class="bg-white rounded-xl shadow-lg overflow-hidden">
      <table class="min-w-full divide-y divide-gray-200">
        <thead class="bg-gray-50">
          <tr>
            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Utilisateur</th>
            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Email</th>
            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">R√¥le</th>
            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Statut</th>
            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Actions</th>
          </tr>
        </thead>
        <tbody class="bg-white divide-y divide-gray-200">
          @for (user of usersStore.filteredUsers(); track user.id) {
            <tr class="hover:bg-gray-50 transition">
              <td class="px-6 py-4 whitespace-nowrap">
                <div class="flex items-center">
                  <div class="flex-shrink-0 h-10 w-10 rounded-full bg-purple-100 flex items-center justify-center">
                    <span class="text-purple-600 font-semibold">{{ user.firstName.charAt(0) }}{{ user.lastName.charAt(0) }}</span>
                  </div>
                  <div class="ml-4">
                    <div class="text-sm font-medium text-gray-900">{{ user.fullName }}</div>
                    <div class="text-sm text-gray-500">ID: {{ user.id }}</div>
                  </div>
                </div>
              </td>
              <td class="px-6 py-4 whitespace-nowrap">
                <div class="text-sm text-gray-900">{{ user.email }}</div>
                @if (user.phone) {
                  <div class="text-sm text-gray-500">{{ user.phone }}</div>
                }
              </td>
              <td class="px-6 py-4 whitespace-nowrap">
                <app-badge [text]="user.role" [variant]="getRoleVariant(user.role)" [size]="'small'" [rounded]="true" />
              </td>
              <td class="px-6 py-4 whitespace-nowrap">
                <app-badge [text]="user.active ? 'Actif' : 'Inactif'" [variant]="user.active ? 'success' : 'warning'" [size]="'small'" [rounded]="true" />
              </td>
              <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
                <a
                  [routerLink]="['/users', user.id]"
                  class="text-purple-600 hover:text-purple-900 mr-4"
                >
                  Voir
                </a>
                <a
                  [routerLink]="['/users', user.id, 'edit']"
                  class="text-blue-600 hover:text-blue-900"
                >
                  Modifier
                </a>
              </td>
            </tr>
          }
        </tbody>
      </table>

      <!-- Stats -->
      <div class="bg-gray-50 px-6 py-4 border-t border-gray-200">
        <div class="text-sm text-gray-600">
          Total: {{ usersStore.usersCount() }} utilisateur(s) |
          Affich√©s: {{ usersStore.filteredUsers().length }} |
          Actifs: {{ usersStore.activeUsers().length }} |
          Admins: {{ usersStore.adminUsers().length }}
        </div>
      </div>
    </div>
  }
</div>
